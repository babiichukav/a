;
(self.AMP=self.AMP||[]).push({m:0,v:"2202230359001",n:"amp-web-push",ev:"0.1",l:!0,f:function(t,n){!function(){function n(t,e){return(n=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,e)}function e(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,n){if(n&&("object"===i(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function u(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,i=r(t);if(n){var u=r(this).constructor;e=Reflect.construct(i,arguments,u)}else e=i.apply(this,arguments);return o(this,e)}}Array.isArray;var s=Object.prototype;function c(t){var n=Object.create(null);return t&&Object.assign(n,t),n}s.hasOwnProperty,s.toString;var a=/(\0)|^(-)$|([\x01-\x1f\x7f]|^-?[0-9])|([\x80-\uffff0-9a-zA-Z_-]+)|[^]/g;function f(t,n,e,r,i){return i||(n?"ï¿½":r?t.slice(0,-1)+"\\"+t.slice(-1).charCodeAt(0).toString(16)+" ":"\\"+t)}function h(t){return String(t).replace(a,f)}var l=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function v(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return decodeURIComponent(t)}catch(t){return n}}function p(t){var n,e=c();if(!t)return e;for(;n=l.exec(t);){var r=v(n[1],n[1]),i=n[2]?v(n[2].replace(/\+/g," "),n[2]):"";e[r]=i}return e}function d(t){var n=(t||self).location;return p(n.originalHash||n.hash)}var m=self.AMP_CONFIG||{},w=("string"==typeof m.thirdPartyFrameRegex?new RegExp(m.thirdPartyFrameRegex):m.thirdPartyFrameRegex,("string"==typeof m.cdnProxyRegex?new RegExp(m.cdnProxyRegex):m.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function b(t){if(!self.document||!self.document.head)return null;if(self.location&&w.test(self.location.origin))return null;var n=self.document.head.querySelector('meta[name="'.concat(t,'"]'));return n&&n.getAttribute("content")||null}m.thirdPartyUrl,m.thirdPartyFrameHost,m.cdnUrl||b("runtime-host"),m.errorReportingUrl,m.betaErrorReportingUrl,m.localDev,m.geoApiUrl||b("amp-geo-api");var g="";function y(t){var n=t||self;return n.__AMP_MODE?n.__AMP_MODE:n.__AMP_MODE=function(t){return{localDev:!1,development:R(t,d(t)),esm:!1,test:!1,rtvVersion:E(t)}}(n)}function E(t){var n;return g||(g=(null===(n=t.AMP_CONFIG)||void 0===n?void 0:n.v)||"01".concat("2202230359001")),g}function R(t,n){var e=n||d(t);return["1","actions","amp","amp4ads","amp4email"].includes(e.development)||!!t.AMP_DEV_MODE}self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var O=self.__AMP_LOG;function S(t,n){throw new Error("failed to call initLogConstructor")}function I(t){return O.user||(O.user=P()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(O.user.win,t)?O.userForEmbed||(O.userForEmbed=P()):O.user}function P(t){return S()}function k(){return O.dev||(O.dev=S())}function _(t,n,e,r,i,o,u,s,c,a,f){return t}var x="amp-web-push",A=x,T=x+"-service",M=x+"-widget",U="granted",C="denied",j="default";function L(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function N(t,n,e){return n&&L(t.prototype,n),e&&L(t,e),t}function D(t,n){t.insertBefore(n,t.firstChild)}var W=function(){var t=this;this.promise=new Promise((function(n,e){t.resolve=n,t.reject=e}))};function F(t,n){_(function(t,n){var e=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!e||!e.ctor)}(t,n));var e=V(t)[n];return e.obj||(_(e.ctor),_(e.context),e.obj=new e.ctor(e.context),_(e.obj),e.context=null,e.resolve&&e.resolve(e.obj)),e.obj}function V(t){var n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}var G,K=function(t){e(r,t);var n=u(r);function r(t){return n.call(this,t)}var i=r.prototype;return i.isLayoutSupported=function(t){return"fixed"==t},i.buildCallback=function(){this.element.classList.add("amp-invisible")},r}(t.BaseElement),H="subscribed",q="unsubscribed",z="blocked";function B(t){return t.data}function Q(t,n,e,r){var i=e,o=function(t,n,e,r){var i=t,o=e,u=function(t){try{return o(t)}catch(t){var n,e;throw null===(n=(e=self).__AMP_REPORT_ERROR)||void 0===n||n.call(e,t),t}},s=function(){if(void 0!==G)return G;G=!1;try{var t={get capture(){return G=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return G}(),c=!(null==r||!r.capture);return i.addEventListener(n,u,s?r:c),function(){null==i||i.removeEventListener(n,u,s?r:c),o=null,i=null,u=null}}(t,n,(function(t){try{i(t)}finally{i=null,o()}}),r);return o}function Y(t){return"AUDIO"===t.tagName||"VIDEO"===t.tagName}var Z,$,J=function(){function t(t,n){this.$i=t,this.bi=n,this.Qvt=null,this.Hi=new Promise((function(){}))}var n=t.prototype;return n.load=function(){var t=this;return this.$i.whenReady().then((function(){var n,e;return t.Qvt=t.$i.win.document.createElement("iframe"),n=t.Qvt,void 0===(e=!1)&&(e=n.hasAttribute("hidden")),e?n.removeAttribute("hidden"):n.setAttribute("hidden",""),t.Qvt.sandbox="allow-same-origin allow-scripts",t.Qvt.src=t.bi,t.$i.getBody().appendChild(t.Qvt),t.Hi=function(t){var n,e;if(function(t){return!!(t.complete||"complete"==t.readyState||Y(t)&&t.readyState>0||t.document&&"complete"==t.document.readyState)}(t))return Promise.resolve(t);var r=Y(t);return r&&t.__AMP_MEDIA_LOAD_FAILURE_SRC===t.currentSrc?Promise.reject(t):new Promise((function(i,o){if(n=r?Q(t,"loadedmetadata",i,{capture:!0}):Q(t,"load",i),t.tagName){var u=t;if(r&&!t.hasAttribute("src")&&!(u=function(t,n){for(var e=t.lastElementChild;e;e=e.previousElementSibling)if(n(e))return e;return null}(t,(function(t){return"SOURCE"===t.tagName}))))return o(new Error("Media has no source."));e=Q(u,"error",o)}})).then((function(){return e&&e(),t}),(function(){n&&n(),function(t){Y(t)&&(t.__AMP_MEDIA_LOAD_FAILURE_SRC=t.currentSrc||!0);var n=t;throw n&&n.src&&(n=n.src),I().createError("Failed to load:",n)}(t)}))}(t.Qvt),t.whenReady()}))},n.getDomElement=function(){return this.Qvt},n.whenReady=function(){return this.Hi},t}(),X=function(){function t(t){this.Wt=t,this.Kt=0,this.Qt=0,this.Xt=c()}var n=t.prototype;return n.has=function(t){return!!this.Xt[t]},n.get=function(t){var n=this.Xt[t];if(n)return n.access=++this.Qt,n.payload},n.put=function(t,n){this.has(t)||this.Kt++,this.Xt[t]={payload:n,access:this.Qt},this.Yt()},n.Yt=function(){if(!(this.Kt<=this.Wt)){var t,n=this.Xt,e=this.Qt+1;for(var r in n){var i=n[r].access;i<e&&(e=i,t=r)}void 0!==t&&(delete n[t],this.Kt--)}},t}();function tt(t,n){return Z||(Z=self.document.createElement("a"),$=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new X(100))),function(t,n,e){if(e&&e.has(n))return e.get(n);t.href=n,t.protocol||(t.href=t.href);var r,i={href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:"0"==t.port?"":t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:null};"/"!==i.pathname[0]&&(i.pathname="/"+i.pathname),("http:"==i.protocol&&80==i.port||"https:"==i.protocol&&443==i.port)&&(i.port="",i.host=i.hostname),r=t.origin&&"null"!=t.origin?t.origin:"data:"!=i.protocol&&i.host?i.protocol+"//"+i.host:i.href,i.origin=r;var o=i;return e&&e.put(n,o),o}(Z,t,n?null:$)}new Set(["c","v","a","ad"]);var nt=function(){function t(t){t||(t={debug:!1,windowContext:window}),this.zt={},this.sr={},this.ar=t.debug,this.cr=!1,this.lr=!1,this.hr=!1,this.vr=null,this.dr=null,this.pr=null,this.mr=null,this.gr=null,this.wr=t.windowContext||window}var n=t.prototype;return n.listen=function(n){var e=this;return new Promise((function(t,r){e.hr?r(new Error("Already connected.")):e.cr?r(new Error("Already listening for connections.")):Array.isArray(n)?(e.pr=e.yr.bind(e,n,t,r),e.wr.addEventListener("message",e.pr),e.ar&&k().fine(x,"Listening for a connection message...")):r(new Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",n))})).then((function(){e.send(t.Topics.CONNECT_HANDSHAKE,null),e.hr=!0}))},n.Er=function(t,n){for(var e=tt(t).origin,r=0;r<n.length;r++)if(tt(n[r]).origin===e)return!0;return!1},n.yr=function(n,e,r,i){var o=B(i),u=i.origin,s=i.ports;this.ar&&k().fine(x,"Window message for listen() connection received:",o),this.Er(u,n)?o&&o.topic===t.Topics.CONNECT_HANDSHAKE?(k().fine(x,"Received expected connection handshake message:",o),this.wr.removeEventListener("message",this.pr),this.dr=s[0],this.gr=this.br.bind(this),this.dr.addEventListener("message",this.gr,!1),this.dr.start(),e()):k().fine(x,"Discarding connection message because it did not contain our expected handshake:",o):k().fine(x,"Discarding connection message from ".concat(u," ")+"because it isn't an allowed origin:",o," (allowed  origins are)",n)},n.connect=function(n,e){var r=this;return new Promise((function(i,o){n||o(new Error("Provide a valid Window context to connect to.")),e||o(new Error("Provide an expected origin for the remote Window or provide the wildcard *.")),r.hr?o(new Error("Already connected.")):r.lr?o(new Error("Already connecting.")):(r.vr=new MessageChannel,r.dr=r.vr.port1,r.mr=r.Rr.bind(r,r.dr,e,i),r.dr.addEventListener("message",r.mr),r.dr.start(),n.postMessage({topic:t.Topics.CONNECT_HANDSHAKE},"*"===e?"*":tt(e).origin,[r.vr.port2]),k().fine(x,"Opening channel to ".concat(e,"...")))}))},n.Rr=function(t,n,e){this.hr=!0,this.ar&&k().fine(x,"Messenger channel to ".concat(n," established.")),t.removeEventListener("message",this.mr),this.gr=this.br.bind(this),t.addEventListener("message",this.gr,!1),e()},n.br=function(t){var n=B(t);if(this.zt[n.id]&&n.isReply){var e=this.zt[n.id];delete this.zt[n.id];var r=e.promiseResolver;e.message=n.data,this.ar&&k().fine(x,"Received reply for topic '%s': %s",n.topic,n.data),r([n.data,this.Ar.bind(this,n.id,e.topic)])}else{var i=this.sr[n.topic];if(!i)return;this.ar&&k().fine(x,"Received new message for "+"topic '".concat(n.topic,"': ").concat(n.data));for(var o=0;o<i.length;o++)(0,i[o])(n.data,this.Ar.bind(this,n.id,n.topic))}},n.on=function(t,n){this.sr[t]?this.sr[t].push(n):this.sr[t]=[n]},n.off=function(t,n){if(n){var e=this.sr[t].indexOf(n);-1!==e&&this.sr[t].splice(e,1)}else this.sr[t]&&delete this.sr[t]},n.Ar=function(t,n,e){var r=this,i={id:t,topic:n,data:e,isReply:!0};return this.dr.postMessage(i),new Promise((function(t){r.zt[i.id]={message:e,topic:n,promiseResolver:t}}))},n.send=function(t,n){var e=this,r={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:t,data:n};return this.ar&&k().fine(x,"Sending %s: %s",t,n),this.dr.postMessage(r),new Promise((function(i){e.zt[r.id]={message:n,topic:t,promiseResolver:i}}))},N(t,null,[{key:"Topics",get:function(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}}]),t}(),et="amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/";function rt(t,n,e){if(n[e])return n[e];var r=t.querySelector("style[".concat(e,"], link[").concat(e,"]"));return r?(n[e]=r,r):null}function it(t,n){for(var e=t.styleSheets,r=0;r<e.length;r++)if(e[r].ownerNode==n)return!0;return!1}function ot(t){return n=T,function(t,n){var e=function(t,n){var e=V(t)[n];return e?e.promise?e.promise:(F(t,n),e.promise=Promise.resolve(e.obj)):null}(t,n);if(e)return e;var r,i,o,u,s=V(t);return s[n]=(i=(r=new W).promise,o=r.reject,u=r.resolve,i.catch((function(){})),{obj:null,promise:i,resolve:u,reject:o,context:null,ctor:null}),s[n].promise}((o=(e=t).nodeType?(i=e,r=(i.ownerDocument||i).defaultView,function(t,n){return F(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),"ampdoc")}(r)).getAmpDoc(e):e).isSingleDoc()?o.win:o,n);var n,e,r,i,o}var ut=function(){function t(t){this.ampdoc=t,function(t,n,e,r,i){var o=t.getHeadNode(),u=function(t,n,e,r){var i=t.__AMP_CSS_SM;i||(i=t.__AMP_CSS_SM=c());var o="amp-extension=".concat(r);if(o){var u=rt(t,i,o);if(u)return"STYLE"==u.tagName&&u.textContent!==n&&(u.textContent=n),u}var s=(t.ownerDocument||t).createElement("style");s.textContent=n;return s.setAttribute("amp-extension",r),function(t,n){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e){var r=e.nextSibling;t.insertBefore(n,r)}else D(t,n)}(t,s,rt(t,i,"amp-runtime")),o&&(i[o]=s),s}(o,function(t,n){var e=t.__AMP_CSS_TR;return e?e(n):n}(o,"amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/"),0,"amp-web-push");if(e){var s=t.getRootNode();if(it(s,u))return u;var a=setInterval((function(){it(s,u)&&clearInterval(a)}),4)}}(t,0,(function(){})),this.p_={"helper-iframe-url":null,"permission-dialog-url":null,"service-worker-url":null,debug:null},this.ar=y().development,this.fb=null,this.tdt=null,this.ndt=new nt({debug:this.ar}),this.edt=null}var n=t.prototype;return n.start=function(t){var n=this;if(k().fine(x,"amp-web-push extension starting up."),!this.environmentSupportsWebPush())return I().warn(x,"Web push is not supported."),Promise.reject("Web push is not supported");this.initializeConfig(t);var e=this.installHelperFrame();return e.then((function(){return k().fine(x,"Helper frame ".concat(n.p_["helper-iframe-url"]," ")+"DOM loaded. Connecting to the frame via postMessage()..."),n.ndt.connect(n.fb.getDomElement().contentWindow,tt(n.p_["helper-iframe-url"]).origin)})).then((function(){if(!n.isContinuingSubscriptionFromRedirect())return n.updateWidgetVisibilities();n.rdt()})),e},n.initializeConfig=function(t){this.p_=t,this.p_},n.installHelperFrame=function(){var t=-1!==this.p_["helper-iframe-url"].indexOf("?")?"&":"?",n="".concat(this.p_["helper-iframe-url"]).concat(t)+"parentOrigin=".concat(this.ampdoc.win.location.origin);return this.fb=new J(this.ampdoc,n),this.fb.load()},n.isContinuingSubscriptionFromRedirect=function(){return-1!==(this.ampdoc.win.testLocation||this.ampdoc.win.location).search.indexOf(t.PERMISSION_POPUP_URL_FRAGMENT)},n.removePermissionPopupUrlFragmentFromUrl=function(n){return n.replace("?".concat(t.PERMISSION_POPUP_URL_FRAGMENT),"").replace("&".concat(t.PERMISSION_POPUP_URL_FRAGMENT),"")},n.idt=function(t,n){var e=this;return this.fb.whenReady().then((function(){return e.ndt.send(t,n)})).then((function(e){var r=e[0];if(r.success)return r.result;throw new Error("AMP page helper iframe query topic ".concat(t," ")+"and message ".concat(n," failed with: ").concat(r.error))}))},n.odt=function(t,n){return this.idt(nt.Topics.SERVICE_WORKER_QUERY,{topic:t,payload:n})},n.queryNotificationPermission=function(){return this.idt(nt.Topics.NOTIFICATION_PERMISSION_STATE,null)},n.udt=function(){return this.idt(nt.Topics.SERVICE_WORKER_STATE,null)},n.registerServiceWorker=function(){var t=this.p_["service-worker-url"],n=this.p_["service-worker-scope"];return this.idt(nt.Topics.SERVICE_WORKER_REGISTRATION,{workerUrl:t,registrationOptions:n?{scope:n}:{}})},n.querySubscriptionStateRemotely=function(){return this.odt("amp-web-push-subscription-state",null)},n.subscribeForPushRemotely=function(){return this.odt("amp-web-push-subscribe",null)},n.unsubscribeFromPushRemotely=function(){return this.odt("amp-web-push-unsubscribe",null)},n.isServiceWorkerActivated=function(){var t=this,n=this;return this.udt().then((function(e){var r=!0===e.isControllingFrame,i=t.isUrlSimilarForQueryParams(e.url,n.p_["service-worker-url"]),o="activated"===e.state;return r&&i&&o}))},n.isUrlSimilarForQueryParams=function(t,n){var e=tt(t),r=p(e.search),i=tt(n),o=p(i.search);for(var u in r)if(o[u]!==r[u])return!1;return e.origin===i.origin&&e.pathname===i.pathname},n.setWidgetVisibilities=function(t,n){for(var e=this.ampdoc.getRootNode().querySelectorAll("".concat(h(M),"[visibility=").concat(h(t),"]")),r="amp-invisible",i=0;i<e.length;i++){var o=e[i];n?o.classList.remove(r):o.classList.add(r)}},n.sdt=function(t){return this.ampdoc.getRootNode().querySelectorAll("".concat(h(M),"[visibility=").concat(h(t),"]")).length>0},n.cdt=function(t){if("boolean"==typeof t)return 1},n.adt=function(){var t=this;return this.queryNotificationPermission().then((function(n){t.tdt=n}))},n.updateWidgetVisibilities=function(){var t=this;return this.adt().then((function(){return t.fdt(nt.Topics.STORAGE_GET)})).then((function(n){return!0===n?t.hdt("amp-web-push-notification-permission"):Promise.resolve(j)})).then((function(n){if(n!==C)return t.isServiceWorkerActivated().then((function(n){n?t.ldt():t.vdt()}));t.sdt(z)?t.pdt():t.vdt()}))},n.ldt=function(){var n,e=this;return(n=this.ampdoc.win,F(n,"timer")).timeoutPromise(5e3,this.querySubscriptionStateRemotely().then((function(n){if(e.cdt(n)!==t.AMP_VERSION_INITIAL)throw I().createError("The controlling service worker replied to amp-web-push with an unexpected value.");n?(e.setWidgetVisibilities(q,!1),e.setWidgetVisibilities(H,!0),e.setWidgetVisibilities(z,!1)):e.vdt()})),"The controlling service worker does not support amp-web-push.")},n.vdt=function(){this.setWidgetVisibilities(q,!0),this.setWidgetVisibilities(H,!1),this.setWidgetVisibilities(z,!1)},n.pdt=function(){this.setWidgetVisibilities(q,!1),this.setWidgetVisibilities(H,!1),this.setWidgetVisibilities(z,!0)},n.subscribe=function(t){var n=this,e=[];return e.push(this.registerServiceWorker()),e.push(new Promise((function(e){if(n.tdt===U)return n.ddt().then((function(){e()}));var r=n.openPopupOrRedirect();n.mdt(r,t),n.edt=new nt({debug:n.ar}),n.edt.listen([n.p_["permission-dialog-url"]]),n.onPermissionDialogInteracted().then((function(t){return n.handlePermissionDialogInteraction(t)})).then((function(){e()}))}))),Promise.all(e)},n.mdt=function(t,n){var e=this;if(t&&!t.closed)var r=this.ampdoc.win.setInterval((function(){t.closed&&(n(),e.ampdoc.win.clearInterval(r))}),500)},n.handlePermissionDialogInteraction=function(t){var n=t[0],e=t[1];switch(n){case C:case j:return e({closeFrame:!0}),this.updateWidgetVisibilities();case U:e({closeFrame:!0}),this.ddt();break;default:throw new Error("Unexpected permission value:",n)}},n.ddt=function(){var t=this;return this.subscribeForPushRemotely().then((function(){return t.updateWidgetVisibilities()}))},n.unsubscribe=function(){var t=this;return this.unsubscribeFromPushRemotely().then((function(){return t.updateWidgetVisibilities()}))},n.fdt=function(t){return this.idt(nt.Topics.NOTIFICATION_PERMISSION_STATE,{isQueryTopicSupported:t})},n.hdt=function(t){return this.idt(nt.Topics.STORAGE_GET,{key:t})},n.onPermissionDialogInteracted=function(){var t=this;return new Promise((function(n){t.edt.on(nt.Topics.NOTIFICATION_PERMISSION_STATE,(function(t,e){n([t,e])}))}))},t.wdt=function(){var t=Math.floor(Math.min(700,.9*screen.width)),n=Math.floor(Math.min(450,.9*screen.height));return{w:t,h:n,x:Math.floor((screen.width-t)/2),y:Math.floor((screen.height-n)/2)}},n.openPopupOrRedirect=function(){var n=-1!==this.ampdoc.win.location.href.indexOf("?")?"&":"?",e=this.ampdoc.win.location.href+n+t.PERMISSION_POPUP_URL_FRAGMENT,r=-1!==this.p_["permission-dialog-url"].indexOf("?")?"&":"?",i=this.p_["permission-dialog-url"]+r+"return=".concat(encodeURIComponent(e)),o=t.wdt(),u="height=".concat(o.h,",width=").concat(o.w,",left=").concat(o.x,",top=").concat(o.y),s="".concat(u,",resizable=yes,scrollbars=yes");return function(t,n,e,r){var i,o,u;try{i=t.open(n,e,r)}catch(t){k().error("DOM","Failed to open url on target: ",e,t)}return!i&&("number"!=typeof u&&(u=0),u+"noopener".length>(o=r||"").length||-1===o.indexOf("noopener",u))&&(i=t.open(n,"_top")),i}(this.ampdoc.win,i,"_blank",s)},n.rdt=function(){var t=this;this.ampdoc.win.history.replaceState(null,"",this.removePermissionPopupUrlFragmentFromUrl(this.ampdoc.win.location.href)),this.queryNotificationPermission().then((function(n){switch(n){case C:case j:return t.updateWidgetVisibilities();case U:t.ddt();break;default:throw new Error("Unexpected permission value",n)}}))},n.environmentSupportsWebPush=function(){return this.bdt()&&this.gdt()},n.bdt=function(){return void 0!==this.ampdoc.win.Notification&&void 0!==this.ampdoc.win.navigator.serviceWorker&&void 0!==this.ampdoc.win.PushManager},n.gdt=function(){return"https:"===this.ampdoc.win.location.protocol||"localhost"===this.ampdoc.win.location.hostname||"127.0.0.1"===this.ampdoc.win.location.hostname||y().development||!1},N(t,null,[{key:"PERMISSION_POPUP_URL_FRAGMENT",get:function(){return"amp-web-push-subscribing=yes"}},{key:"AMP_VERSION_INITIAL",get:function(){return 1}}]),t}(),st={HELPER_FRAME_URL:"helper-iframe-url",PERMISSION_DIALOG_URL:"permission-dialog-url",SERVICE_WORKER_URL:"service-worker-url",SERVICE_WORKER_SCOPE:"service-worker-scope"},ct=function(t){e(r,t);var n=u(r);function r(t){return n.call(this,t)}var i=r.prototype;return i.validate=function(){this.ydt(),this.Edt();var t,n,e={"helper-iframe-url":null,"permission-dialog-url":null,"service-worker-url":null,"service-worker-scope":null};for(var r in st){var i=st[r];t=this.element.getAttribute(i)||"service-worker-scope"===i,n="The ".concat(i," attribute is required for <").concat(A,">"),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,I().assert(t,n,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined),e[i]=this.element.getAttribute(i)}if(!this.Rdt(e["helper-iframe-url"]))throw I().createError("<".concat(A,"> must have a valid ")+"helper-iframe-url attribute. It should begin with the https:// protocol and point to the provided lightweight template page provided for AMP messaging.");if(!this.Rdt(e["permission-dialog-url"]))throw I().createError("<".concat(A,"> must have a valid ")+"permission-dialog-url attribute. It should begin with the https:// protocol and point to the provided template page for showing the permission prompt.");if("https:"!==tt(e["service-worker-url"]).protocol)throw I().createError("<".concat(A,"> must have a valid ")+"service-worker-url attribute. It should begin with the https:// protocol and point to the service worker JavaScript file to be installed.");if(tt(e["service-worker-url"]).origin!==tt(e["permission-dialog-url"]).origin||tt(e["permission-dialog-url"]).origin!==tt(e["helper-iframe-url"]).origin)throw I().createError("<".concat(A,"> URL attributes ")+"service-worker-url, permission-dialog-url, and helper-iframe-url must all share the same origin.")},i.parseConfig=function(){var t={};for(var n in st){var e=st[n];t[e]=this.element.getAttribute(e)}return t},i.buildCallback=function(){this.validate();var t=this.parseConfig();ot(this.element).then((function(n){n.start(t).catch((function(){}))})),this.registerAction("subscribe",this.Odt.bind(this)),this.registerAction("unsubscribe",this.Sdt.bind(this))},i.ydt=function(){if(this.element.getAttribute("id")!==x)throw I().createError("<".concat(A,"> must have an id ")+"attribute with value '"+x+"'.")},i.Edt=function(){if(this.getAmpDoc().getRootNode().querySelectorAll("#".concat(h(A))).length>1)throw I().createError("Only one <".concat(A,"> element may exist on a page."))},i.Odt=function(t){var n=this,e=t.event.target;this.Idt(e,!0),ot(this.element).then((function(t){t.subscribe((function(){n.Idt(e,!1)})).then((function(){n.Idt(e,!1)}))}))},i.Idt=function(t,n){t.disabled=n},i.Sdt=function(t){var n=this,e=t.event.target;this.Idt(e,!0),ot(this.element).then((function(t){t.unsubscribe().then((function(){n.Idt(e,!1)}))}))},i.Rdt=function(t){try{var n=tt(t),e=n.pathname.length>1;return"https:"===n.protocol&&e}catch(t){return!1}},r}(t.BaseElement);t.registerServiceForDoc(T,ut),t.registerElement(A,ct),t.registerElement(M,K,et)}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-web-push-0.1.js.map